---
title: op-txproxy
lang: en-US
description: A passthrough proxy service that can apply additional constraints on transactions prior to reaching the sequencer.
---

import { Callout, Steps } from 'nextra/components'

# op-txproxy

A [passthrough proxy](https://github.com/ethereum-optimism/infra/tree/main/op-txproxy) for the execution engine endpoint. This proxy does not forward all rpc traffic and only exposes a specific set of methods. Operationally, the ingress router should only re-route request for these methods.

<Callout type="info">
  [proxyd](./proxyd) as an ingress router supports the mapping of specific methods to unique backends.
</Callout>

## Methods

### **eth_sendRawTransactionConditional**

To safely expose this endpoint publicly, additional stateless constraints are applied to horizontally scale validation rules and preemptively reject conditional transactions prior to reaching the sequencer.

A variety of metrics are emitted for to inform adjustments to be made.

#### Authentication

The caller authenticates themselves with any valid ECDSA-secp256k1 key, like an Ethereum key. The computed signature is over the [EIP-191](https://eips.ethereum.org/EIPS/eip-191) hash of the request body. This calling address does **not need to hold an ethereum balance**. It simply is used for identification.

With the signature and signing address, the request is authenticated under the `X-Optimism-Signature` header with the value `<public key address>: <signature>`.

*   Requests with missing a missing authentication header fail with the `-32003` (transaction rejected) json rpc error code.
*   Requests with a mismatch in recovered signer and supplied public key will have the http request failed with status code `400 - Bad Request`.

As of today, no authorization policies are implemented on this endpoint. This has preemptively in place allow for new policies (allowlist, localized rate limits, etc)

#### Runtime Shutoff

This service can be rolled with a flag/env switch to reject conditional transaction without needing to interrupt the execution engine. Useful in diagnosing issues.

`--sendRawTxConditional.enabled (default: true) ($OP_TXPROXY_SENDRAWTXCONDITIONAL_ENABLED)`

When disabled, requests will fail with the `-32003` (transaction rejected) json rpc error code with a message stating that the method is disabled.

#### Rate Limits

Even though the op-geth implementation of this endpoint includes rate limits, it is instead applied here to terminate these requests early.

`--sendRawTxConditional.ratelimit (default: 5000) ($OP_TXPROXY_SENDRAWTXCONDITIONAL_RATELIMIT)`

#### Stateless Validation

*   Conditional cost is below the max
*   Conditional values are valid (i.e min \< max)
*   Transaction target are only 4337 Entrypoint contracts

<Callout type="info">
  The motivating factor for this endpoint is to enable permissionless 4337 mempools, hence the restricted usage of this methods to just [Entrypoint](https://github.com/eth-infinitism/account-abstraction/blob/develop/contracts/core/EntryPoint.sol) transactions.

  Please open up an issue if you'd like this restriction to be optional via configuration to broaden usage of this endpoint.
</Callout>

When the request passes validation, it is passed through to the configured backend URL

`--sendRawTxConditional.backend ($OP_TXPROXY_SENDRAWTXCONDITIONAL_BACKENDS)`


<Callout type="warning">
  Per the [specification](/stack/protocol/features/send-raw-transaction-conditional), conditional transactions are not gossip'd between peers. Thus if you use replicas in an active/passive sequencer setup, this request must be broadcasted to all replicas.

  [proxyd](./proxyd) as an egress router for this method supports this broadcasting functionality.
</Callout>

## How it works

To start using `op-txproxy`, follow these steps:

<Steps>
  ### Build the Binary or Pull the Docker Image

  1.  Run the following command to build the binary
  ```bash
  make build
  ```
  2.  This will build and output the binary under `/bin/op-txproxy`.

  The image for this binary is also available as a [docker artifact](https://us-docker.pkg.dev/oplabs-tools-artifacts/images/op-txproxy).

  ### Configure

  The binary accepts configuration through cli flags which also settable via ENV variables. Either set the flags explicitly when starting the binary or set the environment variables of the host starting the proxy

  See [methods](#methods) on the configuration options available for each method.

  ### Start

  start the service with the following command

  ```bash
  op-txproxy // ... with flags if env variables are not set
  ```
</Steps>
