---
title: op-conductor
lang: en-US
description: Learn what the op-conductor is and how to use it to create a highly available and reliable sequencers.
---

import { Callout, Tabs, Steps } from 'nextra/components'

# op-conductor

This page will teach you what the `op-conductor` service is and how it works on
a high level. It will also get you started on setting it up in your own
environment.

## op-conductor: Enhancing Sequencer Reliability and Availability

The [op-conductor](https://github.com/ethereum-optimism/optimism/tree/develop/op-conductor)
is an auxiliary service designed to enhance the reliability and availability of
a sequencer within high-availability setups. By minimizing the risks
associated with a single point of failure, the op-conductor ensures that the
sequencer remains operational and responsive.

### Assumptions

It is important to note that the `op-conductor` does not incorporate Byzantine
fault tolerance (BFT). This means the system operates under the assumption that
all participating nodes are honest and act correctly.

### Summary of Guarantees

The design of the `op-conductor` provides the following guarantees:

*   **No Unsafe Reorgs**
*   **No Unsafe Head Stall During Network Partition**
*   **100% Uptime with No More Than 1 Node Failure**

## Design

![op-conductor](/img/builders/chain-operators/op-conductor.svg)

**On a high level, `op-conductor` serves the following functions:**

### Raft Consensus Layer Participation

*   **Leader Determination:** Participates in the Raft consensus algorithm to
    determine the leader among sequencers.
*   **State Management:** Stores the latest unsafe block ensuring consistency
    across the system.

### RPC Request Handling

*   **Admin RPC:** Provides administrative RPCs for manual recovery scenarios,
    including, but not limited to: stopping the leadership vote and removing itself
    from the cluster.
*   **Health RPC** Offers health RPCs for the `op-node` to determine whether it
    should allow the publishing of transactions and unsafe blocks.

### Sequencer Health Monitoring

*   Continuously monitors the health of the sequencer (op-node) to ensure
    optimal performance and reliability.

### Control Loop Management

*   Implements a control loop to manage the status of the sequencer (op-node),
    including starting and stopping operations based on different scenarios and
    health checks.

## Conductor State Transition

The following is a state machine diagram of how the op-conductor manages the
sequencers Raft consensus.

![op-conductor-state-transition](/img/builders/chain-operators/op-conductor-state-transition.svg)

**Helpful tips:** To better understand the graph, focus on one node at a time,
understand what can be transitioned to this current state and how it can
transition to other states. This way you could understand how we handle the
state transitions.

## Setup

At OP Labs, op-conductor is deployed as a kubernetes statefulset because it
requires a persistent volume to store the raft log.

### Spin up op-conductor

<Steps>
  {<h3>Setup initial state</h3>}

  *   Sequencer: the sequencer identifier.
  *   Conductor Role: the op-conductor initial role.
  *   [OP\_CONDUCTOR\_PAUSED](#conductor_paused)
  *   [OP\_NODE\_SEQUENCER\_ENABLED](/builders/node-operators/configuration/consensus-config#sequencerenabled)
  *   [OP\_NODE\_CONDUCTOR\_ENABLED](/builders/node-operators/configuration/consensus-config#conductorenabled)

  | Sequencer   | OP\_CONDUCTOR\_PAUSED | OP\_NODE\_SEQUENCER\_ENABLED | OP\_NODE\_CONDUCTOR\_ENABLED |
  | ----------- | --------------------- | ---------------------------- | ---------------------------- |
  | sequencer-0 | true                  | true                         | false                        |
  | sequencer-1 | true                  | false                        | false                        |
  | sequencer-2 | true                  | false                        | false                        |

  {<h3>Enable conductor on sequencers</h3>}

  *   Set `OP_NODE_CONDUCTOR_ENABLED=true` on the sequencers' `op-node` instances
  *   Ensure configuration persistance is turned off.

  {<h3>Switch the active sequencer and enable conductor</h3>}

  *   Rollout `sequencer-2` as the active sequencer. You can use a blue/green
      style deployment to switch from `sequencer-0` to activate `sequencer-2` without
      any downtime.
  *   The `sequencer-2` will now begin to commit unsafe payloads to the raft log
  *   Confirm `sequencer-2` is active and successfully producing unsafe blocks.

  {<h3>Add voting nodes to the cluster</h3>}

  *   Use [AddServerAsVoter](#conductor_addServerAsVoter) to add followers as
      voters

  {<h3>Confirm state</h3>}

  | Sequencer   | Conductor Role | OP\_CONDUCTOR\_PAUSED | OP\_NODE\_SEQUENCER\_ENABLED | OP\_NODE\_CONDUCTOR\_ENABLED |
  | ----------- | -------------- | --------------------- | ---------------------------- | ---------------------------- |
  | sequencer-0 | follower       | true                  | **false**                    | **true**                     |
  | sequencer-1 | follower       | true                  | false                        | **true**                     |
  | sequencer-2 | leader         | true                  | **true**                     | **true**                     |

  {<h3>Resume conductor</h3>}

  *   Use [resume](#conductor_resume) on all nodes

  {<h3>Confirm conductor has resumed</h3>}

  *   Use [paused](#conductor_paused) to confirm all conductors have been
      successfully resumed

  {<h3>Remove paused configuration</h3>}

  *   Remove `OP_CONDUCTOR_PAUSED=true`.

  | Sequencer   | Conductor Role | OP\_CONDUCTOR\_PAUSED | OP\_NODE\_SEQUENCER\_ENABLED | OP\_NODE\_CONDUCTOR\_ENABLED |
  | ----------- | -------------- | --------------------- | ---------------------------- | ---------------------------- |
  | sequencer-0 | follower       | **false**             | false                        | true                         |
  | sequencer-1 | follower       | **false**             | false                        | true                         |
  | sequencer-2 | leader         | **false**             | true                         | true                         |

  {<h3>Set sequencer-0 to leader</h3>}

  *   Set sequencer-0 to be the leader
  *   Confirm the state

  | Sequencer   | Conductor Role | OP\_CONDUCTOR\_PAUSED | OP\_NODE\_SEQUENCER\_ENABLED | OP\_NODE\_CONDUCTOR\_ENABLED |
  | ----------- | -------------- | --------------------- | ---------------------------- | ---------------------------- |
  | sequencer-0 | leader         | false                 | false                        | true                         |
  | sequencer-1 | follower       | false                 | false                        | true                         |
  | sequencer-2 | follower       | false                 | true                         | true                         |
</Steps>

### Configuration Options

It is configured via its [flags / environment variables](https://github.com/ethereum-optimism/optimism/blob/develop/op-conductor/flags/flags.go)

#### --consensus.addr (`CONSENSUS_ADDR`)

*   **Usage:** Address to listen for consensus connections
*   **Default Value:** 127.0.0.1
*   **Required:** yes

#### --consensus.port (`CONSENSUS_PORT`)

*   **Usage:** Port to listen for consensus connections
*   **Default Value:** 50050
*   **Required:** yes

#### --raft.bootstrap (`RAFT_BOOTSTRAP`)

<Callout type="info">
  For bootstrapping a new cluster. This should only be used on the sequencer
  that is currently active and can only be started once with this flag,
  otherwise the flag has to be removed or the raft log must be deleted before
  re-bootstrapping the cluster.
</Callout>

*   **Usage:** If this node should bootstrap a new raft cluster
*   **Default Value:** false
*   **Required:** no

#### --raft.server.id (`RAFT_SERVER_ID`)

*   **Usage:** Unique ID for this server used by raft consensus
*   **Default Value:** None specified
*   **Required:** yes

#### --raft.storage.dir (`RAFT_STORAGE_DIR`)

*   **Usage:** Directory to store raft data
*   **Default Value:** None specified
*   **Required:** yes

#### --node.rpc (`NODE_RPC`)

*   **Usage:** HTTP provider URL for op-node
*   **Default Value:** None specified
*   **Required:** yes

#### --execution.rpc (`EXECUTION_RPC`)

*   **Usage:** HTTP provider URL for execution layer
*   **Default Value:** None specified
*   **Required:** yes

#### --healthcheck.interval (`HEALTHCHECK_INTERVAL`)

*   **Usage:** Interval between health checks
*   **Default Value:** None specified
*   **Required:** yes

#### --healthcheck.unsafe-interval (`HEALTHCHECK_UNSAFE_INTERVAL`)

*   **Usage:** Interval allowed between unsafe head and now measured in seconds
*   **Default Value:** None specified
*   **Required:** yes

#### --healthcheck.safe-enabled (`HEALTHCHECK_SAFE_ENABLED`)

*   **Usage:** Whether to enable safe head progression checks
*   **Default Value:** false
*   **Required:** no

#### --healthcheck.safe-interval (`HEALTHCHECK_SAFE_INTERVAL`)

*   **Usage:** Interval between safe head progression measured in seconds
*   **Default Value:** 1200
*   **Required:** no

#### --healthcheck.min-peer-count (`HEALTHCHECK_MIN_PEER_COUNT`)

*   **Usage:** Minimum number of peers required to be considered healthy
*   **Default Value:** None specified
*   **Required:** yes

#### --paused (`PAUSED`)

<Callout type="info">
  There is no configuration state, so if you unpause via RPC and then restart,
  it will start paused again.
</Callout>

*   **Usage:** Whether the conductor is paused
*   **Default Value:** false
*   **Required:** no

#### --rpc.enable-proxy (`RPC_ENABLE_PROXY`)

*   **Usage:** Enable the RPC proxy to underlying sequencer services
*   **Default Value:** true
*   **Required:** no

### RPCs

Conductor exposes [admin RPCs](https://github.com/ethereum-optimism/optimism/blob/develop/op-conductor/rpc/api.go#L17)
on the `conductor` namespace.

#### conductor\_overrideLeader

`OverrideLeader` is used to override the leader status, this is only used to
return true for `Leader()` & `LeaderWithID()` calls. It does not impact the
actual raft consensus leadership status. It is supposed to be used when the
cluster is unhealthy and the node is the only one up, to allow batcher to
be able to connect to the node, so that it could download blocks from the
manually started sequencer.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_overrideLeader","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_overrideLeader --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_pause

`Pause`, pauses op-conductor.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_pause","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_pause --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_resume

`Resume`, resumes op-conductor.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_resume","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_resume --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_paused

Paused returns true if op-conductor is paused.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_paused","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_paused --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_stopped

Stopped returns true if op-conductor is stopped.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_stopped","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_stopped --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_sequencerHealthy

SequencerHealthy returns true if the sequencer is healthy.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_sequencerHealthy","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_sequencerHealthy --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_leader

<Callout type="info">
  API related to consensus.
</Callout>

Leader returns true if the server is the leader.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_leader","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_leader --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_leaderWithID

<Callout type="info">
  API related to consensus.
</Callout>

LeaderWithID returns the current leader's server info.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_leaderWithID","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_leaderWithID --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_addServerAsVoter

<Callout type="info">
  API related to consensus.
</Callout>

AddServerAsVoter adds a server as a voter to the cluster.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_addServerAsVoter","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_addServerAsVoter --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_addServerAsNonvoter

<Callout type="info">
  API related to consensus.
</Callout>

AddServerAsNonvoter adds a server as a non-voter to the cluster. non-voter
will not participate in leader election.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_addServerAsNonvoter","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_addServerAsNonvoter --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_removeServer

<Callout type="info">
  API related to consensus.
</Callout>

RemoveServer removes a server from the cluster.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_removeServer","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_removeServer --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_transferLeader

<Callout type="info">
  API related to consensus.
</Callout>

TransferLeader transfers leadership to another server.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_transferLeader","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_transferLeader --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_transferLeaderToServer

<Callout type="info">
  API related to consensus.
</Callout>

TransferLeaderToServer transfers leadership to a specific server.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_transferLeaderToServer","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_transferLeaderToServer --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_clusterMembership

ClusterMembership returns the current cluster membership configuration.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_clusterMembership","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_clusterMembership --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_active

<Callout type="info">
  API called by `op-node`.
</Callout>

Active returns true if op-conductor is active (not paused or stopped).

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_active","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_active --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor\_commitUnsafePayload

<Callout type="info">
  API called by `op-node`.
</Callout>

CommitUnsafePayload commits an unsafe payload (latest head) to the consensus
layer.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_commitUnsafePayload","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    ```sh
    cast rpc conductor_commitUnsafePayload --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

## Next Steps

*   Checkout [op-conductor-mon](https://github.com/ethereum-optimism/infra):
    which monitors multiple op-conductor instances and provides a unified interface
    for reporting metrics.
