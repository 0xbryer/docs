---
title: op-conductor
lang: en-US
description: Learn what the op-conductor is and how to use it to create a highly available and reliable sequencers.
---

import { Callout, Tabs } from 'nextra/components'

# op-conductor

This page will teach you what the `op-conductor` service is and how it works on
a high level. It will also get you started on setting it up in your own 
environment.

## op-conductor: Enhancing Sequencer Reliability and Availability

The [op-conductor](https://github.com/ethereum-optimism/optimism/tree/develop/op-conductor) 
is an auxiliary service designed to enhance the reliability and availability of
a sequencer within high-availability setups. By minimizing the risks 
associated with a single point of failure, the op-conductor ensures that the 
sequencer remains operational and responsive.

### Assumptions

It is important to note that the `op-conductor` does not incorporate Byzantine 
fault tolerance (BFT). This means the system operates under the assumption that 
all participating nodes are honest and act correctly. 

### Summary of Guarantees

The design of the `op-conductor` provides the following guarantees:

*   **No Unsafe Reorgs** 
*   **No Unsafe Head Stall During Network Partition**
*   **100% Uptime with No More Than 1 Node Failure**

## Design

![op-conductor](/img/builders/chain-operators/op-conductor.svg)

**On a high level, `op-conductor` serves the following functions:**

### Raft Consensus Layer Participation

*   **Leader Determination:** Participates in the Raft consensus algorithm to 
determine the leader among sequencers.
*   **State Management:** Stores the latest unsafe block ensuring consistency 
across the system.
 

### RPC Request Handling

*   **Admin RPC:** Provides administrative RPCs for manual recovery scenarios, 
including, but not limited to: stopping the leadership vote and removing itself 
from the cluster.
*   **Health RPC** Offers health RPCs for the `op-node` to determine whether it 
should allow the publishing of transactions and unsafe blocks.

### Sequencer Health Monitoring

*   Continuously monitors the health of the sequencer (op-node) to ensure 
optimal performance and reliability.

### Control Loop Management

*   Implements a control loop to manage the status of the sequencer (op-node), 
including starting and stopping operations based on different scenarios and 
health checks.

## Conductor State Transition

The following is a state machine diagram of how the op-conductor manages the 
sequencers Raft consensus.

![op-conductor-state-transition](/img/builders/chain-operators/op-conductor-state-transition.svg)

**Helpful tips:** To better understand the graph, focus on one node at a time, 
understand what can be transitioned to this current state and how it can 
transition to other states. This way you could understand how we handle the 
state transitions.

## Setup

At OP Labs, op-conductor is deployed as a kubernetes statefulset because it 
requires a persistent volume to store the raft log.

### Configuration Options

It is configured via it's [flags / environment variables](https://github.com/ethereum-optimism/optimism/blob/develop/op-conductor/flags/flags.go)

#### --consensus.addr (`CONSENSUS_ADDR`)

- **Usage:** Address to listen for consensus connections
- **Default Value:** 127.0.0.1
- **Required:** yes

#### --consensus.port (`CONSENSUS_PORT`)

- **Usage:** Port to listen for consensus connections
- **Default Value:** 50050
- **Required:** yes

#### --raft.bootstrap (`RAFT_BOOTSTRAP`)

<Callout type="info">
  For bootstrapping a new cluster. This should only be used on the sequencer 
  that is currently active and can only be started once with this flag, 
  otherwise the flag has to be removed or the raft log must be deleted before 
  re-bootstrapping the cluster.
</Callout>

- **Usage:** If this node should bootstrap a new raft cluster
- **Default Value:** false
- **Required:** no

#### --raft.server.id (`RAFT_SERVER_ID`)

- **Usage:** Unique ID for this server used by raft consensus
- **Default Value:** None specified
- **Required:** yes

#### --raft.storage.dir (`RAFT_STORAGE_DIR`)

- **Usage:** Directory to store raft data
- **Default Value:** None specified
- **Required:** yes

#### --node.rpc (`NODE_RPC`)

- **Usage:** HTTP provider URL for op-node
- **Default Value:** None specified
- **Required:** yes

#### --execution.rpc (`EXECUTION_RPC`)

- **Usage:** HTTP provider URL for execution layer
- **Default Value:** None specified
- **Required:** yes

#### --healthcheck.interval (`HEALTHCHECK_INTERVAL`)

- **Usage:** Interval between health checks
- **Default Value:** None specified
- **Required:** yes

#### --healthcheck.unsafe-interval (`HEALTHCHECK_UNSAFE_INTERVAL`)

- **Usage:** Interval allowed between unsafe head and now measured in seconds
- **Default Value:** None specified
- **Required:** yes

#### --healthcheck.safe-enabled (`HEALTHCHECK_SAFE_ENABLED`)

- **Usage:** Whether to enable safe head progression checks
- **Default Value:** false
- **Required:** no

#### --healthcheck.safe-interval (`HEALTHCHECK_SAFE_INTERVAL`)

- **Usage:** Interval between safe head progression measured in seconds
- **Default Value:** 1200
- **Required:** no

#### --healthcheck.min-peer-count (`HEALTHCHECK_MIN_PEER_COUNT`)

- **Usage:** Minimum number of peers required to be considered healthy
- **Default Value:** None specified
- **Required:** yes

#### --paused (`PAUSED`)

<Callout type="info">
  There is no configuration state, so if you unpause via RPC and then restart,
  it will start paused again.
</Callout>

- **Usage:** Whether the conductor is paused
- **Default Value:** false
- **Required:** no

#### --rpc.enable-proxy (`RPC_ENABLE_PROXY`)

- **Usage:** Enable the RPC proxy to underlying sequencer services
- **Default Value:** true
- **Required:** no

### RPCs

Conductor exposes [admin RPCs](https://github.com/ethereum-optimism/optimism/blob/develop/op-conductor/rpc/api.go#L17)
on the `conductor` namespace.

#### conductor_overrideLeader

`OverrideLeader` is used to override the leader status, this is only used to
return true for `Leader()` & `LeaderWithID()` calls. It does not impact the 
actual raft consensus leadership status. It is supposed to be used when the 
cluster is unhealthy and the node is the only one up, to allow batcher to 
be able to connect to the node, so that it could download blocks from the 
manually started sequencer.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_overrideLeader","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_overrideLeader --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_pause

Pause pauses op-conductor.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_pause","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_pause --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_resume

Resume resumes op-conductor.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_resume","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_resume --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_paused

Paused returns true if op-conductor is paused.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_paused","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_paused --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_stopped

Stopped returns true if op-conductor is stopped.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_stopped","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_stopped --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_sequencerHealthy

SequencerHealthy returns true if the sequencer is healthy.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_sequencerHealthy","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_sequencerHealthy --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_leader

<Callout type="info">
  API related to consensus.
</Callout>

Leader returns true if the server is the leader.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_leader","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_leader --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_leaderWithID

<Callout type="info">
  API related to consensus.
</Callout>

LeaderWithID returns the current leader's server info.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_leaderWithID","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_leaderWithID --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_addServerAsVoter

<Callout type="info">
  API related to consensus.
</Callout>

AddServerAsVoter adds a server as a voter to the cluster.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_addServerAsVoter","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_addServerAsVoter --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_addServerAsVoter

<Callout type="info">
  API related to consensus.
</Callout>

AddServerAsNonvoter adds a server as a non-voter to the cluster. non-voter 
will not participate in leader election.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_addServerAsVoter","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_addServerAsVoter --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_removeServer

<Callout type="info">
  API related to consensus.
</Callout>

RemoveServer removes a server from the cluster.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_removeServer","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_removeServer --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_transferLeader

<Callout type="info">
  API related to consensus.
</Callout>

TransferLeader transfers leadership to another server.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_transferLeader","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_transferLeader --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_transferLeaderToServer

<Callout type="info">
  API related to consensus.
</Callout>

TransferLeaderToServer transfers leadership to a specific server.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_transferLeaderToServer","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_transferLeaderToServer --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_clusterMembership

ClusterMembership returns the current cluster membership configuration.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_clusterMembership","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_clusterMembership --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_active

<Callout type="info">
  API called by `op-node`.
</Callout>

Active returns true if op-conductor is active (not paused or stopped).

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_active","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_active --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

#### conductor_commitUnsafePayload

<Callout type="info">
  API called by `op-node`.
</Callout>

CommitUnsafePayload commits an unsafe payload (latest head) to the consensus 
layer.

<Tabs items={['curl', 'cast']}>
  <Tabs.Tab>
    ```sh
    curl -X POST -H "Content-Type: application/json" --data \
        '{"jsonrpc":"2.0","method":"conductor_commitUnsafePayload","params":[],"id":1}'  \
        http://127.0.0.1:50050
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```sh
    cast rpc conductor_commitUnsafePayload --rpc-url http://127.0.0.1:50050
    ```
  </Tabs.Tab>
</Tabs>

Sample success output:

```json
todo: add success output
```

## Next Steps

*   Checkout [op-conductor-mon](https://github.com/ethereum-optimism/infra):
which monitors multiple op-conductor instances and provides a unified interface
for reporting metrics.
