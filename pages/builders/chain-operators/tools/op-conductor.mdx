---
title: op-conductor
lang: en-US
description: Learn what the op-conductor is and how to use it to create a highly available and reliable sequencers.
---

import { Callout, Steps } from 'nextra/components'

# op-conductor

This page will teach you what the `op-conductor` service is and how it works on
a high level. It will also get you started on setting it up in your own 
environment.

## op-conductor: Enhancing Sequencer Reliability and Availability

The [op-conductor](https://github.com/ethereum-optimism/optimism/tree/develop/op-conductor) 
is an auxiliary service designed to enhance the reliability and availability of
a sequencer within high-availability setups. By minimizing the risks 
associated with a single point of failure, the op-conductor ensures that the 
sequencer remains operational and responsive.

### Assumptions

It is important to note that the `op-conductor` does not incorporate Byzantine 
fault tolerance (BFT). This means the system operates under the assumption that 
all participating nodes are honest and act correctly. 

### Summary of Guarantees

The design of the `op-conductor` provides the following guarantees:

*   **No Unsafe Reorgs** 
*   **No Unsafe Head Stall During Network Partition**
*   **100% Uptime with No More Than 1 Node Failure**

## Design

![op-conductor](/img/builders/chain-operators/op-conductor.svg)

**On a high level, `op-conductor` serves the following functions:**

### Raft Consensus Layer Participation

*   **Leader Determination:** Participates in the Raft consensus algorithm to 
determine the leader among sequencers.
*   **State Management:** Stores the latest unsafe block ensuring consistency 
across the system.
 

### RPC Request Handling

*   **Admin RPC:** Provides administrative RPCs for manual recovery scenarios, 
including, but not limited to: stopping the leadership vote and removing itself 
from the cluster.
*   **Health RPC** Offers health RPCs for the `op-node` to determine whether it 
should allow the publishing of transactions and unsafe blocks.

### Sequencer Health Monitoring

*   Continuously monitors the health of the sequencer (op-node) to ensure 
optimal performance and reliability.

### Control Loop Management

*   Implements a control loop to manage the status of the sequencer (op-node), 
including starting and stopping operations based on different scenarios and 
health checks.

## Conductor State Transition

The following is a state machine diagram of how the op-conductor manages the 
sequencers Raft consensus.

![op-conductor-state-transition](/img/builders/chain-operators/op-conductor-state-transition.svg)

**Helpful tips:** To better understand the graph, focus on one node at a time, 
understand what can be transitioned to this current state and how it can 
transition to other states. This way you could understand how we handle the 
state transitions.

## Setup

At OP Labs, op-conductor is deployed as a kubernetes statefulset because it 
requires a persistent volume to store the raft log.

### Configuration Options

It is configured via it's [flags / environment variables](https://github.com/ethereum-optimism/optimism/blob/develop/op-conductor/flags/flags.go)

#### --consensus.addr (`CONSENSUS_ADDR`)

- **Usage:** Address to listen for consensus connections
- **Default Value:** 127.0.0.1
- **Required:** yes

#### --consensus.port (`CONSENSUS_PORT`)

- **Usage:** Port to listen for consensus connections
- **Default Value:** 50050
- **Required:** yes

#### --raft.bootstrap (`RAFT_BOOTSTRAP`)

<Callout type="info">
  For bootstrapping a new cluster. This should only be used on the sequencer 
  that is currently active and can only be started once with this flag, 
  otherwise the flag has to be removed or the raft log must be deleted before 
  re-bootstrapping the cluster.
</Callout>

- **Usage:** If this node should bootstrap a new raft cluster
- **Default Value:** false
- **Required:** no

#### --raft.server.id (`RAFT_SERVER_ID`)

- **Usage:** Unique ID for this server used by raft consensus
- **Default Value:** None specified
- **Required:** yes

#### --raft.storage.dir (`RAFT_STORAGE_DIR`)

- **Usage:** Directory to store raft data
- **Default Value:** None specified
- **Required:** yes

#### --node.rpc (`NODE_RPC`)

- **Usage:** HTTP provider URL for op-node
- **Default Value:** None specified
- **Required:** yes

#### --execution.rpc (`EXECUTION_RPC`)

- **Usage:** HTTP provider URL for execution layer
- **Default Value:** None specified
- **Required:** yes

#### --healthcheck.interval (`HEALTHCHECK_INTERVAL`)

- **Usage:** Interval between health checks
- **Default Value:** None specified
- **Required:** yes

#### --healthcheck.unsafe-interval (`HEALTHCHECK_UNSAFE_INTERVAL`)

- **Usage:** Interval allowed between unsafe head and now measured in seconds
- **Default Value:** None specified
- **Required:** yes

#### --healthcheck.safe-enabled (`HEALTHCHECK_SAFE_ENABLED`)

- **Usage:** Whether to enable safe head progression checks
- **Default Value:** false
- **Required:** no

#### --healthcheck.safe-interval (`HEALTHCHECK_SAFE_INTERVAL`)

- **Usage:** Interval between safe head progression measured in seconds
- **Default Value:** 1200
- **Required:** no

#### --healthcheck.min-peer-count (`HEALTHCHECK_MIN_PEER_COUNT`)

- **Usage:** Minimum number of peers required to be considered healthy
- **Default Value:** None specified
- **Required:** yes

#### --paused (`PAUSED`)

<Callout type="info">
  There is no configuration state, so if you unpause via RPC and then restart,
  it will start paused again.
</Callout>

- **Usage:** Whether the conductor is paused
- **Default Value:** false
- **Required:** no

#### --rpc.enable-proxy (`RPC_ENABLE_PROXY`)

- **Usage:** Enable the RPC proxy to underlying sequencer services
- **Default Value:** true
- **Required:** no


