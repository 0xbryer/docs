---
title: Creating Your Own L2 Rollup Testnet
lang: en-US
description: This tutorial walks you through spinning up an OP Stack testnet chain.
---

import { Callout, Steps } from 'nextra/components'









## Generate the L2 config files

Now that you've set up the L1 smart contracts you can automatically generate several configuration files that are used within the Consensus Client and the Execution Client.

You need to generate three important files:

1.  `genesis.json` includes the genesis state of the chain for the Execution Client.
2.  `rollup.json` includes configuration information for the Consensus Client.
3.  `jwt.txt` is a [JSON Web Token](https://jwt.io/introduction) that allows the Consensus Client and the Execution Client to communicate securely (the same mechanism is used in Ethereum clients).

<Steps>

{<h3>Navigate to the op-node package</h3>}

```bash
cd ~/optimism/op-node
```

{<h3>Create genesis files</h3>}

Now you'll generate the `genesis.json` and `rollup.json` files within the `op-node` folder:

```bash
go run cmd/main.go genesis l2 \
  --deploy-config ../packages/contracts-bedrock/deploy-config/getting-started.json \
  --deployment-dir ../packages/contracts-bedrock/deployments/getting-started/ \
  --outfile.l2 genesis.json \
  --outfile.rollup rollup.json \
  --l1-rpc $L1_RPC_URL
```

{<h3>Create an authentication key</h3>}

Next you'll create a [JSON Web Token](https://jwt.io/introduction) that will be used to authenticate the Consensus Client and the Execution Client.
This token is used to ensure that only the Consensus Client and the Execution Client can communicate with each other.
You can generate a JWT with the following command:

```bash
openssl rand -hex 32 > jwt.txt
```

{<h3>Copy genesis files into the op-geth directory</h3>}

Finally, you'll need to copy the `genesis.json` file and `jwt.txt` file into `op-geth` so you can use it to initialize and run `op-geth`:

```bash
cp genesis.json ~/op-geth
cp jwt.txt ~/op-geth
```

</Steps>

## Initialize `op-geth`

You're almost ready to run your chain!
Now you just need to run a few commands to initialize `op-geth`.
You're going to be running a Sequencer node, so you'll need to import the `Sequencer` private key that you generated earlier.
This private key is what your Sequencer will use to sign new blocks.

<Steps>

{<h3>Navigate to the op-geth directory</h3>}

```bash
cd ~/op-geth
```

{<h3>Create a data directory folder</h3>}

```bash
mkdir datadir
```

{<h3>Initialize op-geth</h3>}

```bash
build/bin/geth init --datadir=datadir genesis.json
```

</Steps>

## Start `op-geth`

Now you'll start `op-geth`, your Execution Client.
Note that you won't start seeing any transactions until you start the Consensus Client in the next step.

<Steps>

{<h3>Open up a new terminal</h3>}

You'll need a terminal window to run `op-geth` in.

{<h3>Navigate to the op-geth directory</h3>}

```bash
cd ~/op-geth
```

{<h3>Run op-geth</h3>}

<Callout type="info">
You're using `--gcmode=archive` to run `op-geth` here because this node will act as your Sequencer.
It's useful to run the Sequencer in archive mode because the `op-proposer` requires access to the full state.
Feel free to run other (non-Sequencer) nodes in full mode if you'd like to save disk space.
</Callout>

<Callout type="info">
It's important that you've already initialized the geth node at this point as per the previous section. Failure to do this will cause startup issues between `op-geth` and `op-node`.
</Callout>

```bash
./build/bin/geth \
  --datadir ./datadir \
  --http \
  --http.corsdomain="*" \
  --http.vhosts="*" \
  --http.addr=0.0.0.0 \
  --http.api=web3,debug,eth,txpool,net,engine \
  --ws \
  --ws.addr=0.0.0.0 \
  --ws.port=8546 \
  --ws.origins="*" \
  --ws.api=debug,eth,txpool,net,engine \
  --syncmode=full \
  --gcmode=archive \
  --nodiscover \
  --maxpeers=0 \
  --networkid=42069 \
  --authrpc.vhosts="*" \
  --authrpc.addr=0.0.0.0 \
  --authrpc.port=8551 \
  --authrpc.jwtsecret=./jwt.txt \
  --rollup.disabletxpoolgossip=true
```

</Steps>

## Start `op-node`

Once you've got `op-geth` running you'll need to run `op-node`.
Like Ethereum, the OP Stack has a Consensus Client (`op-node`) and an Execution Client (`op-geth`).
The Consensus Client "drives" the Execution Client over the Engine API.

<Steps>

{<h3>Open up a new terminal</h3>}

You'll need a terminal window to run the `op-node` in.

{<h3>Navigate to the op-node directory</h3>}

```bash
cd ~/optimism/op-node
```

{<h3>Run op-node</h3>}

```bash
./bin/op-node \
  --l2=http://localhost:8551 \
  --l2.jwt-secret=./jwt.txt \
  --sequencer.enabled \
  --sequencer.l1-confs=5 \
  --verifier.l1-confs=4 \
  --rollup.config=./rollup.json \
  --rpc.addr=0.0.0.0 \
  --rpc.port=8547 \
  --p2p.disable \
  --rpc.enable-admin \
  --p2p.sequencer.key=$GS_SEQUENCER_PRIVATE_KEY \
  --l1=$L1_RPC_URL \
  --l1.rpckind=$L1_RPC_KIND
```

Once you run this command, you should start seeing the `op-node` begin to sync L2 blocks from the L1 chain.
Once the `op-node` has caught up to the tip of the L1 chain, it'll begin to send blocks to `op-geth` for execution.
At that point, you'll start to see blocks being created inside of `op-geth`.

<Callout type="info">
**By default, your `op-node` will try to use a peer-to-peer to speed up the synchronization process.**
If you're using a chain ID that is also being used by others, like the default chain ID for this tutorial (42069), your `op-node` will receive blocks signed by other sequencers.
These requests will fail and waste time and network resources.
**To avoid this, this tutorial starts with peer-to-peer synchronization disabled (`--p2p.disable`).**

Once you have multiple nodes, you may want to enable peer-to-peer synchronization.
You can add the following options to the `op-node` command to enable peer-to-peer synchronization with specific nodes:

```
  --p2p.static=<nodes> \
  --p2p.listen.ip=0.0.0.0 \
  --p2p.listen.tcp=9003 \
  --p2p.listen.udp=9003 \
```

You can alternatively also remove the [--p2p.static](/builders/node-operators/management/configuration#p2pstatic) option, but you may see failed requests from other chains using the same chain ID.
</Callout>

</Steps>

## Start `op-batcher`

The `op-batcher` takes transactions from the Sequencer and publishes those transactions to L1.
Once these Sequencer transactions are included in a finalized L1 block, they're officially part of the canonical chain.
The `op-batcher` is critical!

It's best to give the `Batcher` address at least 1 Sepolia ETH to ensure that it can continue operating without running out of ETH for gas.
Keep an eye on the balance of the `Batcher` address because it can expend ETH quickly if there are a lot of transactions to publish.

<Steps>

{<h3>Open up a new terminal</h3>}

You'll need a terminal window to run the `op-batcher` in.

{<h3>Navigate to the op-batcher directory</h3>}

```bash
cd ~/optimism/op-batcher
```

{<h3>Run op-batcher</h3>}

```bash
./bin/op-batcher \
  --l2-eth-rpc=http://localhost:8545 \
  --rollup-rpc=http://localhost:8547 \
  --poll-interval=1s \
  --sub-safety-margin=6 \
  --num-confirmations=1 \
  --safe-abort-nonce-too-low-count=3 \
  --resubmission-timeout=30s \
  --rpc.addr=0.0.0.0 \
  --rpc.port=8548 \
  --rpc.enable-admin \
  --max-channel-duration=1 \
  --l1-eth-rpc=$L1_RPC_URL \
  --private-key=$GS_BATCHER_PRIVATE_KEY
```

<Callout type="info">
The `--max-channel-duration=n` setting tells the batcher to write all the data to L1 every `n` L1 blocks.
When it is low, transactions are written to L1 frequently and other nodes can synchronize from L1 quickly.
When it is high, transactions are written to L1 less frequently and the batcher spends less ETH.
If you want to reduce costs, either set this value to 0 to disable it or increase it to a higher value.
</Callout>

</Steps>

## Start `op-proposer`

Now start `op-proposer`, which proposes new state roots.

<Steps>

{<h3>Open up a new terminal</h3>}

You'll need a terminal window to run the `op-proposer` in.

{<h3>Navigate to the op-proposer directory</h3>}

```bash
cd ~/optimism/op-proposer
```

{<h3>Run op-proposer</h3>}

```bash
./bin/op-proposer \
  --poll-interval=12s \
  --rpc.port=8560 \
  --rollup-rpc=http://localhost:8547 \
  --l2oo-address=$(cat ../packages/contracts-bedrock/deployments/getting-started/L2OutputOracleProxy.json | jq -r .address) \
  --private-key=$GS_PROPOSER_PRIVATE_KEY \
  --l1-eth-rpc=$L1_RPC_URL
```

</Steps>

## Connect Your Wallet to Your Chain

You now have a fully functioning OP Stack Rollup with a Sequencer node running on `http://localhost:8545`.
You can connect your wallet to this chain the same way you'd connect your wallet to any other EVM chain.
If you need an easy way to connect to your chain, just [click here](https://chainid.link?network=opstack-getting-started).

## Get ETH On Your Chain

Once you've connected your wallet, you'll probably notice that you don't have any ETH to pay for gas on your chain.
The easiest way to deposit Sepolia ETH into your chain is to send ETH directly to the `L1StandardBridge` contract.

<Steps>

{<h3>Navigate to the contracts-bedrock directory</h3>}

```bash
cd ~/optimism/packages/contracts-bedrock
```

{<h3>Get the address of the L1StandardBridgeProxy contract</h3>}

```bash
cat deployments/getting-started/L1StandardBridgeProxy.json | jq -r .address
```

{<h3>Send some Sepolia ETH to the L1StandardBridgeProxy contract</h3>}

Grab the L1 bridge proxy contract address and, using the wallet that you want to have ETH on your Rollup, send that address a small amount of ETH on Sepolia (0.1 or less is fine).
This will trigger a deposit that will mint ETH into your wallet on L2.
It may take up to 5 minutes for that ETH to appear in your wallet on L2.

</Steps>

## See Your Rollup in Action

You can interact with your Rollup the same way you'd interact with any other EVM chain.
Send some transactions, deploy some contracts, and see what happens!

## Next Steps

*   You can [modify the blockchain in various ways](../hacks/overview).
*   Check out the [protocol specs](https://specs.optimism.io/) for more detail about the rollup protocol.
*   If you run into any problems, please visit the [Chain Operators Troubleshooting Guide](../management/troubleshooting) for help.
