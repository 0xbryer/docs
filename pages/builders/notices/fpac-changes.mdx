---
title: Preparing for Fault Proof Changes
lang: en-US
description: Learn how to prepare for Fault Proof Alpha changes.
---

import { Steps, Callout } from 'nextra/components'

# Preparing for Fault Proof Changes

FPAC introduces a couple important changes that certain teams and developers will need to be aware.
This document is meant to help you understand what's changing, who's impacted, and how teams will need to prepare.

## L2OutputOracle

### Changes

The `L2OutputOracle` smart contract is currently used by the trusted Proposer role to store L2 state output proposals. Users today use these outputs to prove that their withdrawals actually happened on L2. The `L2OutputOracle` is being entirely removed in favor of a new contract called the `DisputeGameFactory`.

### Impact

Most users will not be directly impacted by this change, some will be indirectly impacted. The `L2OutputOracle` contract is not typically used directly but is instead used through the `OptimismPortal` contract. The FP team has done analysis that shows no significant contracts are relying on the `L2OutputOracle` directly.

Any project performing withdrawals programmatically will need to update their client code (see `OptimismPortal` changes below). Most teams use the Optimism SDK or Viem and will simply need to update their software version ahead of the upgrade.

## OptimismPortal

### Changes

The `OptimismPortal` smart contract is the low-level contract on L1 used to execute deposits and withdrawals. The `OptimismPortal` is changing slightly with FPAC because it now points to the `DisputeGameFactory` contract instead of the `L2OutputOracle` contract. Most notable change for users is that withdrawals will have to be proven against the `rootClaim` of some dispute game rather than referencing an output in the `L2OutputOracle` contract.

### Impact

Most significant impact of this change is that users will have to change how their client software proves withdrawals in the first step of the two-step withdrawal process.

Previously, clients would look at the `L2OutputOracle` to find the exact next output that included their withdrawal. Now, clients must look at the `OptimismPortal` contract to determine the `respectedGameType` and then use this information to query the `DisputeGameFactory` for a list of recent `DisputeGame` contracts with the correct game type.

It is recommended that clients search for a reasonable number of recent games, say 100 games, and pick the first proposal with a sufficient block number. Clients should then verify this proposal locally as the default game type will allow for permissionless proposals and there is no longer a strong guarantee that proposals will be valid.

Most teams will not need to worry about this directly. Teams typically rely on client software like the Optimism SDK or Viem to handle this logic under the hood. Low-level changes here are only relevant to teams that have rolled their own withdrawal logic.

## Optimism SDK

### Changes

The Optimism SDK is changing under the hood to support the new `OptimismPortal` logic described above. The Optimism SDK changes do not break the API of the SDK and automatically update the internal logic used when the upgrade goes live.

### Impact

The Optimism SDK changes do not break the API and require no changes other than updating to the correct software version. The Optimism SDK will automatically begin to use the new logic once it detects that the FPAC update has gone live.

**Instructions:** Upgrade your [Optimism SDK](https://sdk.optimism.io/) to version `3.2.0` or later to include the fault proof changes.

## Viem

TODO: Fill this out once we've coordinated with the Wagmi team.

<Callout type="warning">
Viem will need to be updated and version information will be coming soon.
</Callout>

## Withdrawal Monitor

### Changes

The Withdrawal Monitor service is an important part of the two-step withdrawal system that checks if anyone has been able to prove withdrawals that do not actually appear on L2. The Withdrawal Monitor is being updated slightly for FPAC to be simpler and to be able to more easily support any OP Stack chain.

### Impact

Changes to the Withdrawal Monitor are entirely backwards compatible. The Withdrawal Monitor is now slightly slower at startup time but is more reliable and compatible with more infrastructure. Teams should update their Withdrawal Monitor before the FPAC update goes live to avoid accidentally not checking certain withdrawals.

## Fault Monitor

### Changes

The Fault Monitor service detects when invalid outputs have been proposed. Given the large number of changes to the output proposal system, the current Fault Monitor is being dropped in favor of a new Fault Monitor purpose-built for the FPAC system.

### Impact

Any team running the current Fault Monitor will see the monitor stop functioning when the FPAC upgrade goes live. These teams should run the new service and update their alerting accordingly.
<Callout type="warning">
Fault Monitor will need to be updated and version information will be coming soon.
</Callout>

## Next Steps

*   See the [Fault Proofs Overview](/stack/protocol/fault-proofs/overview) to learn more about the three main components of the Fault Proof System.
*   You can also read more about [Cannon FPVM](/stack/protocol/fault-proofs/cannon) and [Mips.sol](/stack/protocol/fault-proofs/mips), the on-chain smart contract implementation of Cannon.
