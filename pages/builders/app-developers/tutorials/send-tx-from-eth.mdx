---
title: Triggering OP Mainnet Transactions from Ethereum using Viem
lang: en-US
description: Learn how to force transaction inclusion without the OP Mainnet Sequencer using Viem.
---

import { Callout, Steps } from 'nextra/components'
import { WipCallout } from '@/components/WipCallout'

<WipCallout />
# Triggering OP Mainnet Transactions from Ethereum using Viem

OP Mainnet currently uses a single-Sequencer block production model. 

This means that there is only one Sequencer active on the network at any given time. Single-Sequencer models are simpler than their highly decentralized counterparts but they are also more vulnerable to potential downtime.

Sequencer downtime must not be able to prevent users from transacting on the network. As a result, OP Mainnet includes a mechanism for "forcing" transactions to be included in the blockchain. This mechanism involves triggering a transaction on OP Mainnet by sending a transaction on Ethereum.

In this tutorial you'll learn how to trigger a transaction on OP Mainnet from Ethereum using Viem. You'll use the OP Sepolia testnet, but the same logic will apply to OP Mainnet.

## Dependencies

* [node](https://nodejs.org/en/)
* [pnpm](https://pnpm.io/installation)

## Create a Demo Project

You're going to use the `viem` package for this tutorial. Since Viem is a [Node.js](https://nodejs.org/en/) library, you'll need to create a Node.js project to use it.

<Steps>

{<h3>Make a Project Folder</h3>}

```bash
mkdir op-sample-project
cd op-sample-project
```

{<h3>Initialize the Project</h3>}

```bash
pnpm init
```

{<h3>Install Viem</h3>}

```bash
pnpm add viem
```

</Steps>

<Callout type="info">
Want to create a new wallet for this tutorial?
If you have [`cast`](https://book.getfoundry.sh/getting-started/installation) installed you can run `cast wallet new` in your terminal to create a new wallet and get the private key.
</Callout>

## Get ETH on Sepolia and OP Sepolia

This tutorial explains how to bridge tokens from Sepolia to OP Sepolia. You will need to get some ETH on both of these testnets.

<Callout type="info">
You can use [this faucet](https://sepoliafaucet.com) to get ETH on Sepolia.
You can use the [Superchain Faucet](https://console.optimism.io/faucet?utm_source=docs) to get ETH on OP Sepolia.
</Callout>

## Add a Private Key to Your Environment

You need a private key in order to sign transactions. 
Set your private key as an environment variable with the `export` command. 
Make sure this private key corresponds to an address that has ETH on both Sepolia and OP Sepolia.

```bash
export TUTORIAL_PRIVATE_KEY=0x...
```

## Start the Node REPL

You're going to use the Node REPL to interact with Viem. 
To start the Node REPL run the following command in your terminal:

```bash
node
```

This will bring up a Node REPL prompt that allows you to run javascript code.

## Import Dependencies

You need to import some dependencies into your Node REPL session.

<Steps>

{<h3>Import Viem</h3>}

```js
const { createPublicClient, createWalletClient, http, parseEther, formatEther } = require('viem');
const { optimismSepolia, sepolia } = require('viem/chains');
```

</Steps>

## Set Session Variables

You'll need a few variables throughout this tutorial. Let's set those up now.

<Steps>

{<h3>Load your private key</h3>}

```js
const privateKey = process.env.TUTORIAL_PRIVATE_KEY;
```

{<h3>Create the RPC providers and wallets</h3>}

```js
const l1PublicClient = createPublicClient({ chain: sepolia, transport: http() });
const l2PublicClient = createPublicClient({ chain: optimismSepolia, transport: http() });
const l1WalletClient = createWalletClient({ chain: sepolia, transport: http() });
const l2WalletClient = createWalletClient({ chain: optimismSepolia, transport: http() });
```

</Steps>

## Check Your Initial Balance

You'll be sending a small amount of ETH as part of this tutorial. Quickly check your balance on OP Sepolia so that you know how much you had at the start of the tutorial.

```js
const address = await l2WalletClient.account.address;
const initialBalance = await l2PublicClient.getBalance({ address });
console.log(`Initial balance: ${formatEther(initialBalance)} ETH`);
```

## Trigger the Transaction

Now you'll use the `OptimismPortal` contract to trigger a transaction on OP Sepolia by sending a transaction on Sepolia.

<Steps>

{<h3>Create the OptimismPortal object</h3>}

```js
const optimismPortalAbi = [
  {
    inputs: [
      { internalType: 'uint256', name: '_gasLimit', type: 'uint256' },
      { internalType: 'bytes', name: '_data', type: 'bytes' },
    ],
    name: 'depositTransaction',
    outputs: [],
    stateMutability: 'payable',
    type: 'function',
  },
];

const optimismPortalAddress = '0x16fc5058f25648194471939df75cf27a2fdc48bc';
```

{<h3>Estimate the required gas</h3>}

When sending transactions via the `OptimismPortal` contract it's important to always include a gas buffer. This is because the `OptimismPortal` charges a variable amount of gas depending on the current demand for L2 transactions triggered via L1. If you do not include a gas buffer, your transactions may fail.

```js
const gasLimit = 100000n;
const data = '0x';
const value = parseEther('0.000001');

const gasEstimate = await l1PublicClient.estimateContractGas({
  address: optimismPortalAddress,
  abi: optimismPortalAbi,
  functionName: 'depositTransaction',
  args: [gasLimit, data],
  value,
});
```

{<h3>Send the transaction</h3>}

Now you'll send the transaction. Note that you are including a buffer of 20% on top of the gas estimate.

```js
const { hash: l1TxHash } = await l1WalletClient.writeContract({
  address: optimismPortalAddress,
  abi: optimismPortalAbi,
  functionName: 'depositTransaction',
  args: [gasLimit, data],
  value,
  gas: gasEstimate * 120n / 100n, // 20% buffer
});

console.log(`L1 transaction hash: ${l1TxHash}`);
```

{<h3>Wait for the L1 transaction</h3>}

First you'll need to wait for the L1 transaction to be mined.

```js
const l1Receipt = await l1PublicClient.waitForTransactionReceipt({ hash: l1TxHash });
```

{<h3>Wait for the L2 transaction</h3>}

Now you'll need to wait for the corresponding L2 transaction to be included in a block. This transaction is automatically created as a result of your L1 transaction. Here you'll determine the hash of the L2 transaction and then wait for that transaction to be included in the L2 blockchain.

```js
const l2TxHash = l1Receipt.logs[0].topics[1];
const l2Receipt = await l2PublicClient.waitForTransactionReceipt({ hash: l2TxHash });
console.log(`L2 transaction hash: ${l2TxHash}`);
```

</Steps>

## Check Your Updated Balance

You should have a little less ETH on OP Sepolia now. Check your balance to confirm.

```js
const finalBalance = await l2PublicClient.getBalance({ address });
console.log(`Final balance: ${formatEther(finalBalance)} ETH`);
```

Make sure that the difference is equal to the amount you were expecting to send.

```js
const difference = initialBalance - finalBalance;
console.log(`Difference: ${formatEther(difference)} ETH`);
```

## Next Steps

You've successfully triggered a transaction on OP Sepolia by sending a transaction on Sepolia using Viem. Although this tutorial demonstrated the simple example of sending a basic ETH transfer from your L2 address via the OptimismPortal contract, you can use this same technique to trigger any transaction you want. You can trigger smart contracts, send ERC-20 tokens, and more.