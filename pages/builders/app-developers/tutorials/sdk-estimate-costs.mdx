---
title: Estimating Transaction Costs on OP Mainnet
lang: en-US
description: Learn how to use the Viem/op-stack to estimate the cost of a transaction on OP Mainnet.
---

import { Callout, Steps, Tabs } from 'nextra/components'
import { WipCallout } from '@/components/WipCallout'

<WipCallout />
# Estimating Transaction Costs on OP Mainnet


In this tutorial, you'll learn how to use the [Viem](https://viem.sh/op-stack/) to estimate the cost of a transaction on OP Mainnet.
You'll learn how to estimate the [execution gas fee](/builders/app-developers/transactions/fees#execution-gas-fee) and the [L1 data fee](/builders/app-developers/transactions/fees#l1-data-fee) independently.
You'll also learn how to estimate the total cost of the transaction all at once.

<Callout>
Check out the full explainer on [OP Mainnet transaction fees](/builders/app-developers/transactions/fees) for more information on how OP Mainnet charges fees under the hood.
</Callout>

## Prerequisites

Before you begin, ensure you have the following:

*   Node.js (version 14 or later)
*   An understanding of the [viem library](https://viem.sh/op-stack/)
*   `pnpm` installed for managing packages.

## Required Dependencies

*   [node](https://nodejs.org/en/)
*   [pnpm](https://pnpm.io/installation)
*   [viem](https://viem.sh/op-stack/)

Install `pnpm` if you haven't already:

```bash
npm install -g pnpm

```

## Create a Demo Project

<Steps>
  {<h3>Project Setup</h3>}

  Let's create a new project and install the necessary dependencies.

  <Steps>
    {<h4>Create a folder</h4>}

    ```bash
    mkdir op-sample-project
    cd op-sample-project
    ```

    {<h4>Initialize the project</h4>}

    ```bash
    pnpm init
    ```

    {<h4>Install dependencies</h4>}
    
    Install `viem`, and `dotenv` for managing environment variables.

    ```bash
    pnpm add viem dotenv
    ```
  </Steps>


  {<h3>Configure Environment Variables</h3>}

  You need a private key in order to sign transactions.
  Create a `.env` file to securely store your environment variables
  Set your private key as an environment variable with the `export` command.
  Make sure this private key corresponds to an address that has ETH on Sepolia.

  ```bash
  touch .env
  ```

    Add your wallet private key in the `.env` file.
    You need a private key in order to sign transactions.
    Make sure this private key corresponds to an address that has ETH on OP Sepolia.

    ```bash
    RPC_URL=https://optimism-mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID
    TUTORIAL_PRIVATE_KEY=0x...
    ```
</Steps>

<Callout type="warning">
  Never share your private key and avoid committing this file to version control.
</Callout>


## Get ETH on OP Sepolia

This tutorial explains how estimate transaction costs on OP Sepolia.
You will need to get some ETH on OP Sepolia in order to run the code in this tutorial.

<Callout type="info">
You can use the [Superchain Faucet](https://console.optimism.io/faucet?utm_source=docs) to get ETH on OP Sepolia.
</Callout>

## Start the Node REPL

You're going to use the Node REPL to interact with the Viem library.
To start the Node REPL run the following command in your terminal:

```bash
node
```

This will bring up a Node REPL prompt that allows you to run javascript code.

## Import Dependencies

You need to import some dependencies into your Node REPL session.
With `viem`, we will create an account using the private key and create the RPC provider


<Steps>

{<h3>Import the Viem</h3>}

```js

// Import required modules
import { createPublicClient, http } from 'viem'
import { privateKeyToAccount } from 'viem/accounts'
import { optimismSepolia } from 'viem/chains'
import { publicActionsL2 } from 'viem/op-stack'
import * as dotenv from 'dotenv';
// Load environment variables
dotenv.config();
```

</Steps>

## Set Session Variables

You'll need a few variables throughout this tutorial.
Let's set those up now.

<Tabs items={['Create the wallet instance', 'Create the RPC provider']}>
  <Tabs.Tab>
    To create the wallet instance, load your private key, using `privateKeyToAccount`. [`privateKeyToAccount`](https://viem.sh/docs/accounts/local/privateKeyToAccount#privatekeytoaccount) is a viem method used to sign transactions by passing a private key.

    ```js
    const account = privateKeyToAccount(process.env.PRIVATE_KEY);
    ```
  </Tabs.Tab>

  <Tabs.Tab>
    Set up our Viem Clients for the L1(Sepolia) and L2(optimismSepolia)

    ```js
        const publicClient = createPublicClient({
            chain: optimismSepolia,
            transport: http(process.env.RPC_URL),
        }).extend(publicActionsL2());
    ```

  </Tabs.Tab>

</Tabs>

## Estimate Transaction Costs

You're now going to estimate the cost of a transaction on OP Mainnet.
Here you'll estimate the cost of a simple transaction that sends a small amount of ETH from your address to the address `0x1000000000000000000000000000000000000000`.

<Steps>

{<h3>Create the unsigned transaction</h3>}

Viem makes it easy to create unsigned transactions so you can estimate the cost of a transaction before you sign it.
Here you'll create an unsigned transaction that sends a small amount of ETH from your address to the address `0x1000000000000000000000000000000000000000`.

    ```js 
        const tx = await publicClient.sendUnsignedTransaction({
            from: <from_address>, 
            to: <receiver_address>,
            gasPrice: parseGwei('20'), 
            value: parseEther('1') 
        })
    ```
{<h3>Estimate Gas for a Transaction</h3>}

Now that you have created an unsigned transaction that sends a small amount of ETH, we can estimate the gas for that transaction. We will use the `estimateGas` method from viem.

    ```js
        const fromAddress = '0xYourAddress';
        const toAddress = '0xRecipientAddress';
        const value = 0.1n * 10n ** 18n; // 0.1 ETH in wei

        const gasEstimate = await client.estimateGas({
        from: fromAddress,
        to: toAddress,
        value: value,
        });
        console.log(`Estimated Gas: ${gasEstimate}`);
    ```


{<h3>Fetch Current Gas Price</h3>}

You can also fetch the current gas price on Op stack using the `getGasPrice` method from Viem.

    ```js
        const gasPrice = await client.getGasPrice();
        console.log(`Current Gas Price: ${gasPrice}`);
    ```


{<h3>Estimate the L1 data fee</h3>}

On Op stack, transactions also incur an L1 Data Fee (or calldata fee) because data is posted to Ethereum (Layer 1). 
This fee depends on the size of the calldata used by the transaction.

```js
    

```

{<h3>Estimate the total cost</h3>}

Once you've individually estimated the execution gas fee and the L1 data fee, you can sum these two values together to get the total cost of the transaction.

```js file=<rootDir>/public/tutorials/sdk-estimate-costs.js#L28-L29 hash=f7315f3dbf96423569a42c902eeee45c
```

{<h3>Send the transaction</h3>}

Now that you've estimated the total cost of the transaction, go ahead and send it to the network.
This will make it possible to see the actual cost of the transaction to compare to your estimate.

```js file=<rootDir>/public/tutorials/sdk-estimate-costs.js#L32-L34 hash=f0cc7ae37a28a884aa7f47f13b381681
```

{<h3>Check the actual execution gas fee</h3>}

Once you get back the transaction receipt, check the actual execution gas fee.

```js file=<rootDir>/public/tutorials/sdk-estimate-costs.js#L37-L38 hash=3b3ce48412906a44c1d2f6861a99c8a0
```

{<h3>Check the actual L1 data fee</h3>}

You can also check the actual L1 data fee.

```js file=<rootDir>/public/tutorials/sdk-estimate-costs.js#L41-L42 hash=3438ad167823b837f3511759a06e73f3
```

{<h3>Check the actual total cost</h3>}

Sum these two together to get the actual total cost of the transaction.

```js file=<rootDir>/public/tutorials/sdk-estimate-costs.js#L45-L46 hash=d23b6db1b716cba154932fd3d261995e
```

{<h3>Check the difference</h3>}

Finally, check the difference between the estimated total cost and the actual total cost.
This will give you a sense of how accurate your estimate was.
Estimates will never be entirely accurate, but they should be close!

```js file=<rootDir>/public/tutorials/sdk-estimate-costs.js#L49-L50 hash=358adb5552c9f00484a6bb0580109fd8
```

</Steps>
