---
title: Tracing Deposits and Withdrawals
lang: en-US
description: Learn how to use the viem library to trace deposits and withdrawals between L1 and L2.
---

import { Callout, Steps } from 'nextra/components'

# Tracing Deposits and Withdrawals

In this tutorial, you'll learn how to use the [viem](https://viem.sh) library to trace a [Standard Bridge](../bridging/standard-bridge) deposit or withdrawal between L1 and L2.
You'll specifically learn how to determine the status of a deposit or withdrawal and how to retrieve the transaction receipt for the executed transaction on L1 (for withdrawals) or L2 (for deposits).

## Dependencies

*   [node](https://nodejs.org/en/)
*   [pnpm](https://pnpm.io/installation)

## Create a Demo Project

You're going to use the viem library for this tutorial.
Since viem is a [Node.js](https://nodejs.org/en/) library, you'll need to create a Node.js project to use it.

<Steps>
  {<h3>Make a Project Folder</h3>}

  ```bash
  mkdir trace-trx
  cd trace-trx
  ```

  {<h3>Initialize the Project</h3>}

  ```bash
  pnpm init
  ```

  {<h3>Install viem</h3>}

  ```bash
  pnpm add viem 
  ```
</Steps>

## Add RPC URLs to Your Environment

You'll be using the `getTransactionReceipt` function from the viem library during this tutorial. This function use event queries to retrieve the receipt for a deposit or withdrawal.
Since this function uses large event queries, you'll need to use an RPC provider like [Alchemy](https://alchemy.com) that supports indexed event queries.
Grab an L1 and L2 RPC URL for Sepolia and OP Sepolia, respectively.

```bash
export L1_RPC_URL="https://YOUR_L1_ SEPOLIA_RPC_URL_HERE"
export L2_RPC_URL="https://YOUR_L2_OP_SEPOLIA_RPC_URL_HERE"
```

## Start the Node REPL

You're going to use the Node REPL to interact with viem. To start the Node REPL, run the following command in your terminal:

```bash
node
```

This will bring up a Node REPL prompt that allows you to run JavaScript code.

## Import Dependencies

You need to import some dependencies into your Node REPL session.

{<h3>Import viem</h3>}

```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L3-L4 hash=57a929d665f2e5e4a7ecd085ad3d0b01
```

## Set Session Variables

You'll need a few variables throughout this tutorial. Let's set those up now.

<Steps>
  {<h3>Import RPC URLs</h3>}

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L9-L10 hash=014f5d17eddb45fc081c7db9f33361b4
  ```

  {<h3>Set the deposit to trace</h3>}

  You'll be tracing a specific deposit in this tutorial. Deposit tracing is generally based on the transaction hash of the transaction that triggered the deposit. You can replace this transaction hash with your own if you'd like.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L14 hash=367c797c3e9746addedf43857f789eeb
  ```

  {<h3>Set the withdrawal to trace</h3>}

  You'll also be tracing a specific withdrawal in this tutorial. Like with deposits, withdrawal tracing is generally based on the transaction hash of the transaction that triggered the withdrawal. You can replace this transaction hash with your own if you'd like.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L15 hash=545d1eed00ad0a235e2c79c8a87efd30
  ```

  {<h3>Create the RPC providers</h3>}

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L16-L25 hash=067eb34f545b809ac450a5dd5d06dd09
  ```
</Steps>

## Trace a Deposit

You can use viem to trace a deposit.

<Steps>
  {<h3>Get the deposit status</h3>}

  You can query for the deposit status using the transaction hash of the deposit.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L28-L29 hash=bbde51077bd7a3539e03ffc406daf25f
  ```

  {<h3>Get the deposit transaction receipt</h3>}

  Retrieve the transaction receipt for the deposit using the viem client.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L32-L34 hash=077581a56fc7b26f62589f0a6ae99e0d
  ```

  {<h3>Get the deposit transaction</h3>}

  You can directly query for the L2 transaction that executed the deposit.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L36-L38 hash=c67f0abeef0f2f817b7fb04be8f157a6
  ```
</Steps>

## Trace a Withdrawal

You can use viem's functions to trace a withdrawal.

<Steps>
  {<h3>Get the withdrawal status</h3>}

  Like deposits, withdrawals can have multiple statuses depending on where they are in the process.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L40-L42 hash=55ceda3d9d2f9abf037f8b259de14f26
  ```

  {<h3>Get the withdrawal transaction receipt</h3>}

  Retrieve the L1 transaction receipt for the withdrawal.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L44-L46 hash=d784970abbfd37215d33274d60173ab2
  ```

  {<h3>Get the withdrawal transaction</h3>}

  Directly query for the L1 transaction that executed the withdrawal.

  ```js file=<rootDir>/public/tutorials/sdk-trace-txns.js#L48-L50 hash=48358bc45243db4e69de6ed3d49a67f9
  ```
</Steps>

## Next Steps

*   Check out the tutorial on [bridging ERC-20 tokens with the Optimism SDK](./cross-dom-bridge-erc20) to learn how to create deposits and withdrawals.
*   You can also check out the tutorial on [viewing deposits and withdrawals by address](./sdk-view-txns) to find deposits and withdrawals to trace.
