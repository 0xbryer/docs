---
title: Tracing Deposits and Withdrawals
lang: en-US
description: Learn how to use the viem library to trace deposits and withdrawals between L1 and L2.
---

import { Callout, Steps } from 'nextra/components'


# Tracing Deposits and Withdrawals

In this tutorial, you'll learn how to use the [viem](https://viem.sh) library to trace a [Standard Bridge](../bridging/standard-bridge) deposit or withdrawal between L1 and L2.
You'll specifically learn how to determine the status of a deposit or withdrawal and how to retrieve the transaction receipt for the executed transaction on L1 (for withdrawals) or L2 (for deposits).

<Callout>
Check out the tutorial on [Bridging ERC-20 Tokens With the Optimism SDK](./cross-dom-bridge-erc20) to learn how to create deposits and withdrawals.
You can also check out the tutorial on [Viewing Deposits and Withdrawals by Address](./sdk-view-txns) to find deposits and withdrawals to trace.
</Callout>

## Dependencies

*   [node](https://nodejs.org/en/)
*   [pnpm](https://pnpm.io/installation)

## Create a Demo Project

You're going to use the viem library for this tutorial.
Since viem is a [Node.js](https://nodejs.org/en/) library, you'll need to create a Node.js project to use it.

<Steps>

{<h3>Make a Project Folder</h3>}

```bash
mkdir op-sample-project
cd op-sample-project
```

{<h3>Initialize the Project</h3>}

```bash
pnpm init
```

{<h3>Install viem and ethers.js</h3>}

```bash
pnpm add viem 
```
</Steps>

## Add RPC URLs to Your Environment

You'll be using the `getMessageReceipt` function from the viem library during this tutorial. This function use event queries to retrieve the receipt for a deposit or withdrawal.
Since this function uses large event queries, you'll need to use an RPC provider like [Alchemy](https://alchemy.com) that supports indexed event queries.
Grab an L1 and L2 RPC URL for Sepolia and OP Sepolia, respectively.

```bash
export L1_RPC_URL="https://rpc.ankr.com/eth_sepolia"
export L2_RPC_URL="https://sepolia.optimism.io"
```

## Start the Node REPL
You're going to use the Node REPL to interact with viem. To start the Node REPL, run the following command in your terminal:

```bash
node
```
This will bring up a Node REPL prompt that allows you to run JavaScript code.

## Import Dependencies

You need to import some dependencies into your Node REPL session.

{<h3>Import viem</h3>}

```js
const { createPublicClient, http, createWalletClient, parseEther, formatEther } = require('viem');
const { sepolia, optimismSepolia } = require('viem/chains');
```

## Set Session Variables
You'll need a few variables throughout this tutorial. Let's set those up now.

<Steps>
{<h3>Import RPC URLs</h3>}

```js
const l1RpcUrl = process.env.L1_RPC_URL;
const l2RpcUrl = process.env.L2_RPC_URL;
```

{<h3>Set the deposit to trace</h3>}

You'll be tracing a specific deposit in this tutorial. Deposit tracing is generally based on the transaction hash of the transaction that triggered the deposit. You can replace this transaction hash with your own if you'd like.

```js
const depositHash = 'your_deposit_tx_hash';
```

{<h3>Set the withdrawal to trace</h3>}

You'll also be tracing a specific withdrawal in this tutorial. Like with deposits, withdrawal tracing is generally based on the transaction hash of the transaction that triggered the withdrawal. You can replace this transaction hash with your own if you'd like.

```js
const withdrawalHash = 'your_withdrawal_tx_hash';
```

{<h3>Create the RPC providers</h3>}

```js
const l1Client = createPublicClient({
  chain: optimism,
  transport: http(l1RpcUrl),
});


const l2Client = createPublicClient({
  chain: optimism,
  transport: http(l2RpcUrl),
});
```
</Steps>

## Trace a Deposit
You can use viem to trace a deposit.

<Steps>
{<h3>Get the deposit status</h3>}

You can query for the deposit status using the transaction hash of the deposit.

```js
const depositStatus = await l2Client.getTransactionReceipt({ hash: depositHash });
console.log(depositStatus);
```

{<h3>Get the deposit transaction receipt</h3>}

Retrieve the transaction receipt for the deposit using the viem client.

```js
const depositReceipt = await l2Client.getTransaction({ hash: depositHash });
console.log(depositReceipt);
```

{<h3>Parse deposit logs</h3>}

Parse the logs from the deposit receipt for more detailed information.

```js
const depositLogs = depositReceipt.logs;
depositLogs.forEach(log => {
  console.log(log);
});
```

{<h3>Get the deposit transaction</h3>}

You can directly query for the L2 transaction that executed the deposit.

```js
const depositTransaction = await l2Client.getTransaction({ hash: depositHash });
console.log(depositTransaction);
```
</Steps>

## Trace a Withdrawal
You can use viem's functions to trace a withdrawal.

<Steps>
{<h3>Get the withdrawal status</h3>}

Like deposits, withdrawals can have multiple statuses depending on where they are in the process.

```js
const withdrawalStatus = await l1Client.getTransactionReceipt({ hash: withdrawalHash });
console.log(withdrawalStatus);
```
{<h3>Get the withdrawal transaction receipt</h3>}

Retrieve the L1 transaction receipt for the withdrawal.

```js
const withdrawalReceipt = await l1Client.getTransaction({ hash: withdrawalHash });
console.log(withdrawalReceipt);
```

{<h3>Parse withdrawal logs</h3>}

Parse the logs from the withdrawal receipt to get more details.

```js
const withdrawalLogs = withdrawalReceipt.logs;
withdrawalLogs.forEach(log => {
  console.log(log);
});
```

{<h3>Get the withdrawal transaction</h3>}

Directly query for the L1 transaction that executed the withdrawal.

```js
const withdrawalTransaction = await l1Client.getTransaction({ hash: withdrawalHash });
console.log(withdrawalTransaction);
```
</Steps> 